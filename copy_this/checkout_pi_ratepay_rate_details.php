<?php     require('includes/application_top.php');    // if the customer is not logged on, redirect them to the login page    if (!tep_session_is_registered('customer_id')) {        $navigation->set_snapshot();        tep_redirect(tep_href_link(FILENAME_LOGIN, '', 'SSL'));    }    // if there is nothing in the customers cart, redirect them to the shopping cart page    if ($cart->count_contents() < 1) {        tep_redirect(tep_href_link(FILENAME_SHOPPING_CART));    }    // if no shipping method has been selected, redirect the customer to the shipping method selection page    if (!tep_session_is_registered('shipping')) {        tep_redirect(tep_href_link(FILENAME_CHECKOUT_SHIPPING, '', 'SSL'));    }    // avoid hack attempts during the checkout procedure by checking the internal cartID    if (isset($cart->cartID) && tep_session_is_registered('cartID')) {        if ($cart->cartID != $cartID) {            tep_redirect(tep_href_link(FILENAME_CHECKOUT_SHIPPING, '', 'SSL'));        }    }    // load all enabled payment modules    require(DIR_WS_CLASSES . 'payment.php');    $payment_modules = new payment;    require(DIR_WS_LANGUAGES . $language . '/' . FILENAME_CHECKOUT_PAYMENT);    $breadcrumb->add(NAVBAR_TITLE_1, tep_href_link(FILENAME_CHECKOUT_SHIPPING, '', 'SSL'));    $breadcrumb->add(NAVBAR_TITLE_2, tep_href_link(FILENAME_CHECKOUT_PAYMENT, '', 'SSL'));    //Checks if conditions were accepted and all needed ratepay data is send and assigning some Template variables    if (isset($_POST['conditions'])) {        if (isset($_POST['pirprate'])) {            $checking = true;            if (isset($_SESSION['pi_ratepay_rate_total_amount']) == false || $_SESSION['pi_ratepay_rate_total_amount'] == "") {                $checking = false;            } else if (isset($_SESSION['pi_ratepay_rate_amount']) == false || $_SESSION['pi_ratepay_rate_amount'] == "") {                $checking = false;            } else if (isset($_SESSION['pi_ratepay_rate_interest_amount']) == false || $_SESSION['pi_ratepay_rate_interest_amount'] == "") {                $checking = false;            } else if (isset($_SESSION['pi_ratepay_rate_service_charge']) == false || $_SESSION['pi_ratepay_rate_service_charge'] == "") {                $checking = false;            } else if (isset($_SESSION['pi_ratepay_rate_annual_percentage_rate']) == false || $_SESSION['pi_ratepay_rate_annual_percentage_rate'] == "") {                $checking = false;            } else if (isset($_SESSION['pi_ratepay_rate_monthly_debit_interest']) == false || $_SESSION['pi_ratepay_rate_monthly_debit_interest'] == "") {                $checking = false;            } else if (isset($_SESSION['pi_ratepay_rate_number_of_rates']) == false || $_SESSION['pi_ratepay_rate_number_of_rates'] == "") {                $checking = false;            } else if (isset($_SESSION['pi_ratepay_rate_rate']) == false || $_SESSION['pi_ratepay_rate_rate'] == "") {                $checking = false;            } else if (isset($_SESSION['pi_ratepay_rate_last_rate']) == false || $_SESSION['pi_ratepay_rate_last_rate'] == "") {                $checking = false;            }            if ($checking) {                $_SESSION['pi_ratepay_rate_conditions'] = true;                $form = '<form name="pi_coupon" id="pi_coupon" action="checkout_confirmation.php?osCsid=' . tep_session_id() . '" method="post">'                       .    '<input type="hidden" value="' . $_POST['coupon'] . '" name="coupon" id="coupon">'                       . '</form>';                exit($form . '<script type="text/javascript">document.getElementById("pi_coupon").submit();</script>');//tep_redirect(tep_href_link("checkout_confirmation.php", '', 'SSL'));            }        }    } else {        tep_redirect(tep_href_link("checkout_pi_ratepay_rate_terms.php?osCsid=" . tep_session_id(), '', 'SSL'));    }?><!doctype html public "-//W3C//DTD HTML 4.01 Transitional//EN"><html>    <head>        <title>            RatePAY rate calculator        </title>        <link rel="stylesheet" type="text/css" href="stylesheet.css">        <link type="text/css" rel="stylesheet" href="ext/modules/payment/pi_ratepay_rate/ratenrechner/css/style.css">        <script type="text/javascript" src="ext/modules/payment/pi_ratepay_rate/ratenrechner/js/path.js"></script>        <script type="text/javascript" src="ext/modules/payment/pi_ratepay_rate/ratenrechner/js/layout.js"></script>        <script type="text/javascript" src="ext/modules/payment/pi_ratepay_rate/ratenrechner/js/ajax.js"></script>        <script type="text/javascript">            function submitDetails(){                document.getElementById('details').submit();            }                        function submitPiCoupon(){                            }        </script>        <style type="text/css">            .piRpConditionContainer{                font-family: Verdana, Arial, sans-serif;                margin:10px;                color:#2F2F2F;                vertical-align: top;            }            .piRprateCalculatorTd{                font-size:12px;                text-align:center;                vertical-align:top;            }        </style>    </head>    <body>        <?php require (DIR_WS_INCLUDES . 'header.php'); ?>        <table border="0" width="100%" cellspacing="3" cellpadding="3">            <tr>                <td width="<?php echo BOX_WIDTH; ?>" valign="top">                    <table border="0" width="<?php echo BOX_WIDTH; ?>" cellspacing="0" cellpadding="2">                        <?php require(DIR_WS_INCLUDES . 'column_left.php'); ?>                    </table>                </td>                <td align="center">                    <form name="details" id="details" action="checkout_pi_ratepay_rate_details.php?osCsid=<?php echo tep_session_id() ?>" method="post">                        <input type="hidden" id='conditions' name='conditions' value='conditions'>                        <input type="hidden" id='pirprate' name='pirprate'>                        <input type="hidden" value="<?php echo $_POST['coupon']; ?>" name="coupon" id="coupon">                    </form>                </td>                <td class="piRprateCalculatorTd">                    <div id="pirpmain-cont">                    </div>                    <script type="text/javascript">                        if(document.getElementById('pirpmain-cont')) {                            piLoadrateCalculator("<?php echo tep_session_id(); ?>");                        }                    </script>                    <table width="100%">                        <tr>                            <td align="left" width="50%">                                <a href="checkout_pi_ratepay_rate_terms.php?osCsid=<?php echo tep_session_id() ?>">                                    <img src="<?php echo DIR_WS_LANGUAGES . $language; ?>/images/buttons/button_back.gif" alt="Zur&uuml;ck"/>                                </a>                            </td>                            <td align="right" width="50%">                                <a href="javascript:submitDetails();">                                    <img src="<?php echo DIR_WS_LANGUAGES . $language; ?>/images/buttons/button_continue.gif" alt="Weiter"/>                                </a>                            </td>                        </tr>                    </table>                </td>                <td valign="top" width="125">                    <table>                        <?php require(DIR_WS_INCLUDES . 'column_right.php'); ?>                    </table>                </td>            </tr>        </table>        <?php require(DIR_WS_INCLUDES . 'footer.php'); ?>        <br>        <?php require(DIR_WS_INCLUDES . 'application_bottom.php'); ?>    </body></html>